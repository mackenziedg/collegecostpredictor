---
title: "Analysis"
author: "Saad Usmani, Beau Britain, Shane Caldwell, Mackenzie Gray"
date: "November 4, 2017"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

## Introduction

\bigskip
\bigskip
\bigskip

This document analyzes the College Scorecard Dataset provided by the Federal Government from the years 1996 - 2016. The dataset includes over 1700+ variables with names of over 7000+ colleges in the United States. We will explore this dataset and look at interesting relationships between variables and colleges. We also provide an R Shiny App that lets a user put in personal application information and desired college preferences to look at colleges that would be a "best fit" based on provided information, as well as provide potential costs related to loan repayment and average income for a major after graduation.

The dataset is large, spanning over 15 years with 1700 variables. To make our analysis simpler, we chose around 81 variables to look at that relate to a college's descriptive statistics - like admission rates, average SAT/ACT score, average percentage of degrees awarded to a specific major, number of undergraduate students, tuition rates, private and public colleges, etc. We spend the rest of the document detailing useful relations and variables. 

## Cleaning Our Dataset

An average student would like to look at the most recent statistics for a college - so with over 15+ years of data, we only looked at the last 5 years of relevant college statistics. To do this, we merged the years 2010-2015 into one large college data csv file, then took the averages of every column for each College/University. We do this with the following code:

```{r}
df1<-read.csv(file='C:/Users/susmani/Documents/Year 5/Courses/Data Munging/GroupProject1/CollegeScorecard_Raw_Data_2017/CollegeScorecard_Raw_Data/MERGED_2010-15_selected_columns.csv', sep = ',')
df<-df1%>%
  group_by(UNITID, INSTNM, STABBR) %>%   
  summarise_all(funs(mean(.,na.rm=TRUE)))
write.csv(df, 'MERGED_2010-15_AVG.csv', row.names = FALSE)
```

The write.csv line mearly writes a csv file that can easily be looked at. 

### Assessing Quality of Data

Looking at our new table that now consists of only 99 variables, we can assess the quality of our data. 

First, we will look at the completeness of the data. We look at the number of N/A values for each row, the average for each row, and the total number of NA values.

```{r}
head(rowSums(is.na(df)))
mean(rowSums(is.na(df)))
sum(rowSums(is.na(df)))
sum(rowSums(is.na(df)))/(8514*99)
```

We can see that the total number of N/As in the data set is equal to 271,205. This is about 30 percent of the total number of values in the data set. Though, this proportion is inflated by the fact that a number of columns only have N/A values. The average number of NAs in a given row is also equal to 31. 

We also look at if there is an appropriate amount of data to even explore. If we just merge the past 5 years of data with our selected columns, there would be almost 40,000 observations (colleges), since each college would repeat 5 times and there are over 7,000 colleges to have data for. When we filter down with the average of the past years, we receive 8514 observations of 99 variables. This gives us an appropriate amount of data to look at. 

## Explanatory Variable: State

Here, we look at some interesting relations between different states and their college descriptive statistics. On our first boxplot, we look at the different admission rates per state. 

```{r}
attach(df)
boxplot(ADM_RATE ~ STABBR, main = 'Admission Rates per State', xlab = 'State', ylab = 'Admission Rate')
```

From this, we can see that there is a noticeable dip in admission rates between Colorado and Delaware. The range of average admission rates is also quite large for the middle 50 of the states. 

```{r}
boxplot(SATMTMID ~ STABBR, main = 'Average Math SAT per State', xlab = 'State', ylab = 'Math SAT')
```

We also wanted to look at the average Math SAT score per state. The range of average math SAT scores range from somewhere between 500 and 600 points. This is quite a discrepancy between the states and colleges. Some states have colleges that have very high average MATH scores, like MA (where many Ivy League Universities are located), whereas some states have colleges where they all have similar SAT MATH scores.

```{r}
boxplot(MD_EARN_WNE_P6~STABBR, main = 'Average Income in 6 Years', xlab = 'State', ylab = 'Average Income')
```

Here we find the average income for each state within 6 years of graduating. The average income for each state tends to fall between 20,000 and 40,000 with obvious exceptions and outliers in many states. 

```{r}
boxplot(LO_INC_RPY_1YR_RT~STABBR, main = 'Low-Income Repayment Rate 1 Year', xlab = 'State', ylab = '1 Year Repayment Rate')
```

Here, the repayment rate for 1 year for low-income students for all of the states is quite varied. It ranges from 0.2 to as high as 0.5 in some cases. This can be quite a large factor in choosing a college, even though it isn't the obvious factor people look at when choosing a college. For example, choosing a college in Washington -  a state with a high repayment rate - versus a college in Georgia (a much smaller repayment rate) is choosing the difference between a 0.5 repayment rate and less than 0.2. It's a financial factor that makes a difference between states. 

```{r}
boxplot(HI_INC_RPY_1YR_RT~STABBR, main = 'High-Income Repayment Rate 1 Year', xlab = 'State', ylab = '1 Year Repatment Rate')
```

Now, if we look at students that come from high income familires and their repayment rates we can see that it is still quite varied, but rates themselves are much larger than low-income rates. The range in this boxplot consists between 0.4 and as high as 0.8. This, logically, makes more sense considering students that come from high income families will have more funds available to payoff their loans. It could also be that high income students might have smaller loans that they'd be able to pay off quicker since they had funds from their family. 

This income statistic is incredibly important, and now we want to look at that specific statistic in much further detail. 

## Explanatory Variable: Student Debt (Low Income vs High Income)

```{r}
plot(LO_INC_DEBT_MDN, LO_INC_RPY_7YR_RT, xlab = 'Low-Income Debt', ylab = '7-Year Repayment Rate', main = '7-Year Repayment Rates for Low Income Family Debts')
summary(lm(LO_INC_RPY_7YR_RT ~ LO_INC_DEBT_MDN))
```

This plot looks at 7-Year Repayment Rates for Low-Income Family Debts. We want to see if there is a linear association between whether a students comes from a low-income family and whether they will be able to pay off their loans in 7 years. From this, we seem to have unit increase in repayment rate for every increase in 'debt' that a lower-income student has. We see that a low-income student with larger debt actually has a higher repayment rate in 7 years. Calling the lm function on a regression between debt and rate, we see that our beta estimate is 1.761e-05 and has a p-value of 2e-16. Let's compare this to the 7-Year Repayment Rate for Higher Income students. 

```{r}
plot(HI_INC_DEBT_MDN, HI_INC_RPY_7YR_RT, xlab = 'High-Income Debt', ylab = '7-Year Repayment Rate', main = '7-Year Repayment Rates for High Income Family Debts')
summary(lm(HI_INC_RPY_7YR_RT ~ HI_INC_DEBT_MDN))
```

We see the trend continue in that a student coming from a high-income family with higher debt has higher repayment rates. The average rates are higher because these are families with more funds / less loans because of their income bracket. Here, the beta estimate is 1.055e-05 which is higher than the beta estimate from low-income families by approximately 2 magnitudes. Visually, the variance is also smaller compared to low-income family debt.

```{r}
LO_INC_DEBT_MDN.f <- cut(LO_INC_DEBT_MDN,3,labels = c("low", "medium", "high")) 
boxplot(TUITIONFEE_OUT~LO_INC_DEBT_MDN.f, main = 'Out of State Tuition on Low-Income Family Debt Rates', xlab = 'Low-Income Family Debt', ylab = 'Out of State Tuition Rates')
HI.f <- cut(HI_INC_DEBT_MDN,3,labels = c("low", "medium", "high"))
boxplot(TUITIONFEE_OUT~HI.f, main = 'Out of State Tuition on High-Income Family Debt Rates', xlab = 'High-Income Family Debt', ylab = 'Out of State Tuition Rates')
```

Debt can have many varying values, but we wanted to look at trends between three factors for debt between low-income families and high-income families. We cut the debt into three separately spaced levels (low, medium, high) on the different debt levels and created different box plots to look at the general trends that our explanatory variable can explain. 

In the above two graphs, we looked at out-of-state tuition rates for each college that had low, medium, or high low-income debt. We find that on average colleges that have lower debt on for students in low-income families go to colleges with lower out of state tuition rates. For families that have medium-high debt, the college out-of-sate tuition rates tend to be the same. 

Contrast that with those students who have higher-income families. Here, colleges that have lower debt for students in high-income famlities have lower tuition rates - and that colleges with higher tuition rates also have students in high-income families with higher debt. Are high-income students that have bigger debt more likely to spend more on college because they are able to have families that support them more?

```{r}
boxplot(RET_FT4~LO_INC_DEBT_MDN.f, main = 'Retention Rates on Low-Income Family Debt Rates', xlab = 'High-Income Family Debt', ylab = 'Retention Rates')
boxplot(RET_FT4~HI.f, main = 'Retention Rates on High-Income Family Debt Rates', xlab = 'High-Income Family Debt', ylab = 'Retention Rates')
```

Here, we look at retention rates of colleges and relate them to their lower income family debt rates. We find that they all seem to have similar retention rates for each group. Medium debts tend to have larger retention rates, but only a slightly larger advantage comes to play. We compare this to high-income students and see a striking picture. We again see here that students that come from high-income families and have bigger debt also have higher retention rates.

```{r}
boxplot(LO_INC_DEBT_MDN~STABBR, main = 'Low-Income Debt per State', xlab = 'State', ylab = 'Low Income Debt', ylim=c(0,30000))
boxplot(HI_INC_DEBT_MDN~STABBR, main = 'High-Income Debt per State', xlab = 'State', ylab = 'High Income Debt')
```

Here, we look at states and the average amount of debt they have for students in low-income families and high-income families. Interestingly, it looks like higher-income students have more variance in their debts compared to lower-income students and the amount of debt that they acrue during college. Or, it seems that states have a more uniform average debt for low-income students compared to higher-income students. 
